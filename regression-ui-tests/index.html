<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>WNA BugZilla</title>
<link rel="icon" type="image/svg+xml" href="data:image/svg+xml,%3Csvg width='32' height='32' viewBox='0 0 64 64' fill='none' xmlns='http://www.w3.org/2000/svg'%3E%3Crect width='64' height='64' rx='14' fill='%23DE4141'/%3E%3Cpath d='M25 54L30 34H18L39 10L34 30H46L25 54Z' fill='white'/%3E%3C/svg%3E">
<link rel="stylesheet" href="styles.css">
</head>
<body>

<div class="app" id="app">
  <!-- Save Warning Banner -->
  <div class="save-warning" id="save-warning">
    <span class="warning-text">Data lives in browser memory only. Export before closing.</span>
    <button class="btn-export" onclick="exportAll()">Export Data</button>
  </div>

  <!-- Header -->
  <header class="header">
    <h1><span>WNA</span> BugZilla <span style="font-size:15px;font-weight:400;font-style:italic;color:var(--text-muted);margin-left:12px">// it compiles on my machine &trade;</span></h1>
    <div class="header-actions">
      <button class="btn" onclick="showNewBugModal()">+ New Bug</button>
      <button class="btn btn-primary" onclick="showNewRunModal()">+ New Run</button>
      <button class="btn" onclick="showDataModal()">Data Management</button>
    </div>
  </header>

  <!-- Tabs -->
  <nav class="tabs">
    <button class="tab active" data-tab="runs" onclick="switchTab('runs')">Test Runs</button>
    <button class="tab" data-tab="summary" onclick="switchTab('summary')">Summary</button>
    <button class="tab" data-tab="bugs" onclick="switchTab('bugs')">Bug Tracker</button>
    <button class="tab" data-tab="catalog" onclick="switchTab('catalog')">Test Catalog</button>
  </nav>

  <!-- Main Content -->
  <main class="main">

    <!-- ===== TEST RUNS TAB ===== -->
    <div id="tab-runs" class="tab-content">
      <!-- No runs state -->
      <div id="no-runs" class="empty-state">
        <h3>No Test Runs Yet</h3>
        <p>Create a new test run to start tracking results.</p>
        <button class="btn btn-primary" style="margin-top:16px" onclick="showNewRunModal()">+ New Run</button>
      </div>

      <!-- Run content (hidden when no runs) -->
      <div id="run-content" class="hidden">
        <!-- Run selector -->
        <div class="run-selector">
          <label style="font-weight:600;">Test Run:</label>
          <select id="run-select" onchange="selectRun(this.value)"></select>
          <button class="btn btn-sm btn-danger" onclick="deleteCurrentRun()">Delete Run</button>
        </div>

        <!-- Stats -->
        <div class="stats-row" id="run-stats"></div>

        <!-- Progress bar -->
        <div class="card" id="progress-card">
          <div class="card-title">
            <span>Progress</span>
            <span id="progress-text" style="font-size:13px;color:var(--text-muted)"></span>
          </div>
          <div class="progress-bar">
            <div class="progress-bar-inner" id="progress-bar" style="width:0%;background:var(--primary)"></div>
          </div>
        </div>

        <!-- Filters -->
        <div class="card">
          <div class="card-title">
            <span>Filters</span>
            <button class="btn btn-sm" onclick="clearFilters()">Clear All</button>
          </div>
          <div class="filters">
            <div class="filter-group">
              <label>Search TC ID</label>
              <input type="text" id="filter-id" placeholder="e.g. TC-056" oninput="applyFilters()">
            </div>
            <div class="filter-group">
              <label>Section</label>
              <select id="filter-section" onchange="applyFilters()">
                <option value="">All Sections</option>
              </select>
            </div>
            <div class="filter-group">
              <label>Area</label>
              <select id="filter-area" onchange="applyFilters()">
                <option value="">All Areas</option>
              </select>
            </div>
            <div class="filter-group">
              <label>Priority</label>
              <select id="filter-priority" onchange="applyFilters()">
                <option value="">All Priorities</option>
                <option value="High">High</option>
                <option value="Medium">Medium</option>
                <option value="Low">Low</option>
              </select>
            </div>
            <div class="filter-group">
              <label>Status</label>
              <select id="filter-status" onchange="applyFilters()">
                <option value="">All Statuses</option>
                <option value="P">Pass</option>
                <option value="F">Fail</option>
                <option value="S">Skip</option>
                <option value="B">Blocked</option>
                <option value="N">Not Tested</option>
              </select>
            </div>
          </div>
        </div>

        <!-- Test cases table -->
        <div class="card">
          <div class="card-title">
            <span>Test Cases <span id="tc-count" style="font-size:13px;font-weight:400;color:var(--text-muted)"></span></span>
            <div style="display:flex;gap:8px;">
              <button class="btn btn-sm btn-success" onclick="markAllFiltered('P')">All Pass</button>
              <button class="btn btn-sm" onclick="markAllFiltered('S')">All Skip</button>
              <button class="btn btn-sm" onclick="markAllFiltered('')">All Reset</button>
            </div>
          </div>
          <div class="table-wrapper">
            <table class="tc-table">
              <thead>
                <tr>
                  <th style="width:80px">TC ID</th>
                  <th>Name</th>
                  <th style="width:80px">Priority</th>
                  <th style="width:130px">Area</th>
                  <th style="width:100px">Status</th>
                  <th style="width:200px">Comment</th>
                  <th style="width:80px">Bug</th>
                </tr>
              </thead>
              <tbody id="tc-tbody"></tbody>
            </table>
          </div>
        </div>

      </div>
    </div>

    <!-- ===== SUMMARY TAB ===== -->
    <div id="tab-summary" class="tab-content hidden">
      <div id="no-summary" class="empty-state">
        <h3>No Test Runs Yet</h3>
        <p>Create a test run and mark some results to see the summary.</p>
      </div>
      <div id="summary-content" class="hidden">
        <div class="card">
          <div class="card-title">
            <span>Run Summary</span>
            <button class="btn btn-sm" onclick="downloadSummary()">Download Summary MD</button>
          </div>
          <div id="run-summary"></div>
        </div>
      </div>
    </div>

    <!-- ===== BUG TRACKER TAB ===== -->
    <div id="tab-bugs" class="tab-content hidden">
      <div class="card">
        <div class="card-title">
          <span>Bug Tracker</span>
          <div style="display:flex;gap:8px;">
            <button class="btn btn-primary btn-sm" onclick="showNewBugModal()">+ New Bug</button>
            <button class="btn btn-sm" onclick="downloadBugs()">Download Bugs MD</button>
          </div>
        </div>

        <div class="stats-row" id="bug-stats"></div>

        <div class="filters" style="margin-bottom:16px;">
          <div class="filter-group">
            <label>State</label>
            <div class="multi-select" id="bug-filter-state-ms">
              <button type="button" class="multi-select-toggle" onclick="toggleMultiSelect('bug-filter-state-ms')">All States</button>
              <div class="multi-select-dropdown">
                <label class="multi-select-option"><input type="checkbox" value="todo" onchange="onMultiSelectChange('bug-filter-state-ms')"> Todo</label>
                <label class="multi-select-option"><input type="checkbox" value="in-progress" onchange="onMultiSelectChange('bug-filter-state-ms')"> In Progress</label>
                <label class="multi-select-option"><input type="checkbox" value="fixed" onchange="onMultiSelectChange('bug-filter-state-ms')"> Fixed</label>
                <label class="multi-select-option"><input type="checkbox" value="rejected" onchange="onMultiSelectChange('bug-filter-state-ms')"> Rejected</label>
              </div>
            </div>
          </div>
          <div class="filter-group">
            <label>Priority</label>
            <div class="multi-select" id="bug-filter-priority-ms">
              <button type="button" class="multi-select-toggle" onclick="toggleMultiSelect('bug-filter-priority-ms')">All Priorities</button>
              <div class="multi-select-dropdown">
                <label class="multi-select-option"><input type="checkbox" value="High" onchange="onMultiSelectChange('bug-filter-priority-ms')"> High</label>
                <label class="multi-select-option"><input type="checkbox" value="Medium" onchange="onMultiSelectChange('bug-filter-priority-ms')"> Medium</label>
                <label class="multi-select-option"><input type="checkbox" value="Low" onchange="onMultiSelectChange('bug-filter-priority-ms')"> Low</label>
              </div>
            </div>
          </div>
          <div class="filter-group">
            <label>Search</label>
            <input type="text" id="bug-filter-search" placeholder="Search bugs..." oninput="renderBugs()">
          </div>
        </div>

        <div id="bugs-empty" class="empty-state hidden">
          <h3>No Bugs Tracked</h3>
          <p>Bugs are automatically created when marking test cases as Failed, or you can add them manually.</p>
        </div>

        <div class="table-wrapper">
          <table class="bug-table" id="bug-table">
            <thead>
              <tr>
                <th style="width:80px">ID</th>
                <th>Title</th>
                <th style="width:80px">TC</th>
                <th style="width:80px">Priority</th>
                <th style="width:100px">State</th>
                <th style="width:100px">Date</th>
                <th style="width:100px">Actions</th>
              </tr>
            </thead>
            <tbody id="bug-tbody"></tbody>
          </table>
        </div>
      </div>
    </div>

    <!-- ===== TEST CATALOG TAB ===== -->
    <div id="tab-catalog" class="tab-content hidden">
      <div class="card">
        <div class="card-title">
          <span>Test Case Catalog <span id="catalog-count" style="font-size:13px;font-weight:400;color:var(--text-muted)"></span></span>
        </div>

        <div class="filters" style="margin-bottom:16px;">
          <div class="filter-group">
            <label>Search</label>
            <input type="text" id="catalog-search" placeholder="Search by ID or name..." oninput="renderCatalog()">
          </div>
          <div class="filter-group">
            <label>Section</label>
            <select id="catalog-section" onchange="renderCatalog()">
              <option value="">All Sections</option>
            </select>
          </div>
          <div class="filter-group">
            <label>Priority</label>
            <select id="catalog-priority" onchange="renderCatalog()">
              <option value="">All Priorities</option>
              <option value="High">High</option>
              <option value="Medium">Medium</option>
              <option value="Low">Low</option>
            </select>
          </div>
        </div>

        <div id="catalog-list"></div>
      </div>
    </div>

  </main>
</div>

<!-- New Run Modal -->
<div id="new-run-modal" class="modal-overlay hidden" onclick="if(event.target===this)closeModal('new-run-modal')">
  <div class="modal">
    <h2>New Test Run</h2>
    <div class="form-row">
      <label>Tester Name</label>
      <input type="text" id="new-run-tester" placeholder="e.g. Vladimir">
    </div>
    <div class="form-row">
      <label>Build / Branch</label>
      <input type="text" id="new-run-build" placeholder="e.g. develop-b / abc1234">
    </div>
    <div class="form-row">
      <label>Notes (optional)</label>
      <textarea id="new-run-notes" placeholder="Any notes about this test run..."></textarea>
    </div>
    <div class="form-actions">
      <button class="btn" onclick="closeModal('new-run-modal')">Cancel</button>
      <button class="btn btn-primary" onclick="createRun()">Create Run</button>
    </div>
  </div>
</div>

<!-- New Bug Modal -->
<div id="new-bug-modal" class="modal-overlay hidden" onclick="if(event.target===this)closeModal('new-bug-modal')">
  <div class="modal">
    <h2 id="bug-modal-title">New Bug</h2>
    <input type="hidden" id="bug-edit-id">
    <div class="form-row">
      <label>Title</label>
      <input type="text" id="new-bug-title" placeholder="Short description of the bug">
    </div>
    <div class="form-row">
      <label>Related Test Case</label>
      <input type="text" id="new-bug-tc" placeholder="e.g. TC-003 (optional)">
    </div>
    <div class="form-row">
      <label>Priority</label>
      <select id="new-bug-priority">
        <option value="High">High</option>
        <option value="Medium">Medium</option>
        <option value="Low">Low</option>
      </select>
    </div>
    <div class="form-row">
      <label>Description</label>
      <textarea id="new-bug-desc" placeholder="Detailed description, reproduction steps, etc."></textarea>
    </div>
    <div class="form-actions">
      <button class="btn" onclick="closeModal('new-bug-modal')">Cancel</button>
      <button class="btn btn-primary" onclick="saveBug()">Save Bug</button>
    </div>
  </div>
</div>

<!-- TC Detail Modal -->
<div id="tc-detail-modal" class="modal-overlay hidden" onclick="if(event.target===this)closeModal('tc-detail-modal')">
  <div class="modal">
    <div id="tc-detail-content"></div>
    <div class="form-actions">
      <button class="btn" onclick="closeModal('tc-detail-modal')">Close</button>
    </div>
  </div>
</div>

<!-- Data Management Modal -->
<div id="data-modal" class="modal-overlay hidden" onclick="if(event.target===this)closeModal('data-modal')">
  <div class="modal">
    <h2>Data Management</h2>
    <div class="data-section">
      <button class="btn" onclick="downloadSummary()">Download Summary MD</button>
      <button class="btn" onclick="downloadBugs()">Download Bugs MD</button>
      <button class="btn btn-primary" onclick="exportAll()">Export All Data (JSON)</button>
    </div>
    <hr style="border-color:var(--border);margin:16px 0">
    <div class="form-row">
      <label>Import Data (JSON)</label>
      <input type="file" id="import-file" accept=".json" onchange="importData(event)" style="padding:8px">
    </div>
    <hr style="border-color:var(--border);margin:16px 0">
    <div class="form-row">
      <label style="color:var(--danger)">Danger Zone</label>
      <button class="btn btn-danger" onclick="clearAllData()">Clear All Data</button>
    </div>
    <div class="form-actions">
      <button class="btn" onclick="closeModal('data-modal')">Close</button>
    </div>
  </div>
</div>

<script src="test-data.js"></script>
<script src="app.js"></script>

</body>
</html>
